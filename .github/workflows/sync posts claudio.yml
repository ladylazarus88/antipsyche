name: ðŸ“¥ Sync Posts Claudio

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup
        run: |
          git config user.name "Auto-Sync"
          git config user.email "auto-sync@noreply.github.com"
          git pull origin master
          
      - name: Sync posts
        run: |
          # Scarica i post
          wget -q -O source_posts.zip https://github.com/ladylazarus88/antipsyche-post/archive/refs/heads/main.zip
          unzip -q source_posts.zip -d /tmp
          
          # Per ogni file, copia solo se piÃ¹ recente
          for source_file in /tmp/antipsyche-post-main/posts/*.md; do
            filename=$(basename "$source_file")
            dest="src/content/blog/$filename"
            
            if [ ! -f "$dest" ] || [ "$source_file" -nt "$dest" ]; then
              echo "Updating: $filename"
              cp "$source_file" "$dest"
            fi
          done
          
      - name: Commit if changed
        run: |
          if git diff --quiet; then
            echo "No changes"
          else
            git add src/content/blog/
            git commit -m "ðŸ”„ Posts sync: $(date +'%Y-%m-%d %H:%M')"
            git pull origin master --rebase
            git push origin master
          fi